/* How many samples by category? */
SELECT COUNT(*) AS COMPTE, ID_T2S_EVALUATION_CATEGORY 
FROM T_WC_T2S_EVALUATION
WHERE IS_SAMPLE = 1 
AND ASSERTIONS IS NOT NULL AND ASSERTIONS <> '' 
AND ID_T2S_EVALUATION_CATEGORY IS NOT NULL AND ID_T2S_EVALUATION_CATEGORY > 0 
GROUP BY ID_T2S_EVALUATION_CATEGORY
ORDER BY ID_T2S_EVALUATION_CATEGORY;

/* How many evaluations by category? */
SELECT COUNT(*) AS COMPTE, ID_T2S_EVALUATION_CATEGORY 
FROM T_WC_T2S_EVALUATION
WHERE IS_EVAL = 1 
AND ASSERTIONS IS NOT NULL AND ASSERTIONS <> '' 
AND ID_T2S_EVALUATION_CATEGORY IS NOT NULL AND ID_T2S_EVALUATION_CATEGORY > 0 
GROUP BY ID_T2S_EVALUATION_CATEGORY
ORDER BY ID_T2S_EVALUATION_CATEGORY;

/* How many samples and evaluations by category? */
SELECT
    c.ID_T2S_EVALUATION_CATEGORY,
    c.DESCRIPTION,

    /* Raw counts */
    SUM(CASE WHEN e.IS_SAMPLE = 1 THEN 1 ELSE 0 END) AS SAMPLE_COUNT,
    SUM(CASE WHEN e.IS_EVAL   = 1 THEN 1 ELSE 0 END) AS EVAL_COUNT,

    /* Weights (share of total) */
    SUM(CASE WHEN e.IS_SAMPLE = 1 THEN 1 ELSE 0 END)
        / NULLIF(SUM(SUM(CASE WHEN e.IS_SAMPLE = 1 THEN 1 ELSE 0 END)) OVER (), 0)
        AS SAMPLE_WEIGHT,

    SUM(CASE WHEN e.IS_EVAL = 1 THEN 1 ELSE 0 END)
        / NULLIF(SUM(SUM(CASE WHEN e.IS_EVAL = 1 THEN 1 ELSE 0 END)) OVER (), 0)
        AS EVAL_WEIGHT

FROM T_WC_T2S_EVALUATION e
JOIN T_WC_T2S_EVALUATION_CATEGORY c
    ON c.ID_T2S_EVALUATION_CATEGORY = e.ID_T2S_EVALUATION_CATEGORY

WHERE
    e.ASSERTIONS IS NOT NULL
    AND e.ASSERTIONS <> ''
    AND e.ID_T2S_EVALUATION_CATEGORY IS NOT NULL
    AND e.ID_T2S_EVALUATION_CATEGORY > 0

GROUP BY
    c.ID_T2S_EVALUATION_CATEGORY,
    c.DESCRIPTION

ORDER BY
    c.ID_T2S_EVALUATION_CATEGORY;
